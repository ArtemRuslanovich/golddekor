{% extends "catalog/base.html" %}
{% load static %}

{% block title %}
{% if category %}{{ category.name }} - {% endif %}–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤
{% endblock %}

{% block content %}

<!-- –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ -->
<nav class="breadcrumbs">
    <a href="{% url 'catalog:product_list' %}">–ì–ª–∞–≤–Ω–∞—è</a>
    {% if category %} ‚Ä∫ <span>{{ category.name }}</span>{% endif %}
</nav>

<!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –ø–æ–∏—Å–∫ -->
<div class="catalog-header">
    <h1 class="catalog-title">
        {% if category %}
        {{ category.name }}
        {% else %}
        –í—Å–µ —Ç–æ–≤–∞—Ä—ã
        {% endif %}
    </h1>

    <form method="get" class="search-form">
        <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤..." value="{{ query|default:'' }}" class="search-input">
        <button type="submit" class="btn">üîç –ù–∞–π—Ç–∏</button>
    </form>
</div>

<!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ -->
{% if query %}
<div class="search-alert alert">
    –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –¥–ª—è: "<strong>{{ query }}</strong>"
    <a href="{% url 'catalog:product_list' %}" class="alert-link">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ</a>
</div>
{% endif %}

<!-- –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
{% if categories %}
<div class="category-buttons">
    <a href="{% url 'catalog:product_list' %}" class="category-btn {% if not category %}active{% endif %}">
        –í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    </a>
    {% for cat in categories %}
    <a href="{{ cat.get_absolute_url }}"
        class="category-btn {% if category and category.slug == cat.slug %}active{% endif %}">
        {{ cat.name }}
    </a>
    {% endfor %}
</div>
{% endif %}

<!-- –°–µ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
{% if products %}
<div class="product-grid">
    {% for product in products %}
    <div class="product-card">
        <img src="{% if product.image %}{{ product.image.url }}{% else %}{% static 'img/no_image.png' %}{% endif %}"
            alt="{{ product.name }}" class="product-image">

        <h3 class="product-title">{{ product.name }}</h3>

        {% if product.category %}
        <p class="product-category">{{ product.category.name }}</p>
        {% endif %}

        <p class="price">{{ product.price|floatformat:2 }} ‚ÇΩ</p>

        {% if product.stock > 0 %}
        <span class="badge bg-success">–í –Ω–∞–ª–∏—á–∏–∏</span>
        {% else %}
        <span class="badge bg-danger">–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</span>
        {% endif %}

        <div class="product-actions">
            <a href="{{ product.get_absolute_url }}" class="btn-outline-primary">üìã –ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>

            {% if user.is_authenticated and product.stock > 0 %}
            <form action="{% url 'cart:cart_add' product.id %}" method="post">
                {% csrf_token %}
                <button type="submit" class="btn">üõí –í –∫–æ—Ä–∑–∏–Ω—É</button>
            </form>
            {% elif not user.is_authenticated %}
            <a href="{% url 'login' %}" class="btn-outline-secondary">üîí –í–æ–π—Ç–∏ –¥–ª—è –ø–æ–∫—É–ø–∫–∏</a>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>

<!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
{% if products.has_other_pages %}
<div class="pagination">
    {% if products.has_previous %}
    <a
        href="?page={{ products.previous_page_number }}{% if query %}&q={{ query }}{% endif %}{% if category %}&category={{ category.slug }}{% endif %}">‚Üê
        –ù–∞–∑–∞–¥</a>
    {% endif %}

    {% for i in products.paginator.page_range %}
    {% if products.number == i %}
    <span class="active">{{ i }}</span>
    {% else %}
    <a
        href="?page={{ i }}{% if query %}&q={{ query }}{% endif %}{% if category %}&category={{ category.slug }}{% endif %}">{{
        i }}</a>
    {% endif %}
    {% endfor %}

    {% if products.has_next %}
    <a
        href="?page={{ products.next_page_number }}{% if query %}&q={{ query }}{% endif %}{% if category %}&category={{ category.slug }}{% endif %}">–í–ø–µ—Ä—ë–¥
        ‚Üí</a>
    {% endif %}
</div>
{% endif %}

{% else %}
<div class="no-products">
    <h3>üòî –¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
    <p>
        {% if query %}
        –ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É "{{ query }}" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.
        {% else %}
        –í —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤.
        {% endif %}
    </p>
    <a href="{% url 'catalog:product_list' %}" class="btn">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫–∞—Ç–∞–ª–æ–≥—É</a>
</div>
{% endif %}

{% endblock %}